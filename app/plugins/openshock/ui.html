<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenShock Control Panel</title>
    <link rel="stylesheet" href="/css/themes.css">
    <link rel="stylesheet" href="/openshock/openshock.css">
    <script>
        // Apply saved theme immediately to prevent flash
        (function() {
            const savedTheme = localStorage.getItem('dashboard-theme');
            if (savedTheme && savedTheme !== 'night') {
                document.documentElement.setAttribute('data-theme', savedTheme);
            }
        })();
    </script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/i18n-client.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div>
                <h1>‚ö° OpenShock Control Panel</h1>
                <p class="text-muted header-subtitle">TikTok Live Integration mit OpenShock API</p>
            </div>
            <div style="display: flex; align-items: center; gap: 16px;">
                <button id="headerEmergencyStop" class="btn btn-danger" title="Emergency Stop - Immediately stops all shocks and disables further commands">
                    üõë EMERGENCY STOP
                </button>
                <div id="connection-status">
                    <div class="status-badge status-disconnected">
                        <span class="status-dot"></span>
                        <span>Getrennt</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Tabs Navigation -->
        <div class="tabs">
            <button class="tab-button active" data-tab="dashboard">üìä Dashboard</button>
            <button class="tab-button" data-tab="mapper">üîó Event Mapper</button>
            <button class="tab-button" data-tab="gifts">üéÅ Gift Catalog</button>
            <button class="tab-button" data-tab="safety">üõ°Ô∏è Safety</button>
            <button class="tab-button" data-tab="patterns">üéµ Patterns</button>
            <button class="tab-button" data-tab="zappiehell">‚ö° ZappieHell</button>
            <button class="tab-button" data-tab="advanced">‚öôÔ∏è Advanced</button>
        </div>

        <!-- Tab 1: Dashboard -->
        <div id="dashboard" class="tab-content active">
            <!-- Connection Status Card -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Connection Status</h2>
                </div>
                <div class="grid-3">
                    <div class="stat-card">
                        <div class="stat-label">API Status</div>
                        <div class="stat-value" id="apiStatus">‚ö´</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Connection</div>
                        <div class="stat-value" id="connectionState">Offline</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Devices</div>
                        <div class="stat-value" id="deviceCount">0</div>
                    </div>
                </div>
            </div>

            <!-- Test Shock Function -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">‚ö° Test Shock Function</h2>
                </div>
                <div class="form-group">
                    <label class="form-label">Select Device for Test</label>
                    <select class="form-input" id="testShockDevice">
                        <option value="">-- Select a device --</option>
                    </select>
                </div>
                <div class="btn-group">
                    <button class="btn btn-warning btn-lg" id="testShockButton" disabled>
                        ‚ö° Test Shock (1s, 100%)
                    </button>
                </div>
                <p class="text-muted mt-2">
                    <small>‚ö†Ô∏è This will send a 1-second shock at 100% intensity to the selected device.</small>
                </p>
            </div>

            <!-- Devices List -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Devices</h2>
                    <button class="btn btn-primary btn-sm" id="refreshDevices">üîÑ Refresh</button>
                </div>
                <div id="devicesList">
                    <p class="text-muted text-center">No devices found. Configure API key first.</p>
                </div>
            </div>

            <div class="grid-2">
                <!-- Live Queue Status -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Live Queue</h2>
                    </div>
                    <div class="grid-3">
                        <div class="stat-card">
                            <div class="stat-label">Queue Length</div>
                            <div class="stat-value" id="queueLength">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Processing</div>
                            <div class="stat-value" id="queueProcessing">No</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Cmd/Min</div>
                            <div class="stat-value" id="commandsPerMin">0</div>
                        </div>
                    </div>
                </div>

                <!-- Statistics -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Statistics</h2>
                        <button class="btn btn-secondary btn-sm" id="resetStats">üîÑ Reset</button>
                    </div>
                    <div class="grid-3">
                        <div class="stat-card">
                            <div class="stat-label">Total Commands</div>
                            <div class="stat-value" id="totalCommands">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Success Rate</div>
                            <div class="stat-value" id="successRate">0%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Uptime</div>
                            <div class="stat-value" id="uptime">0s</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Commands Log -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Recent Commands</h2>
                    <div class="btn-group">
                        <button class="btn btn-secondary btn-sm" id="clearLog">üóëÔ∏è Clear</button>
                        <button class="btn btn-secondary btn-sm" id="exportLog">üì• Export</button>
                    </div>
                </div>
                <div class="log-container" id="commandLog">
                    <p class="text-muted text-center">No commands executed yet.</p>
                </div>
            </div>

            <!-- Debug Log -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üêõ Debug Log</h2>
                    <div class="btn-group">
                        <button class="btn btn-secondary btn-sm" id="clearDebugLog">üóëÔ∏è Clear</button>
                        <button class="btn btn-secondary btn-sm" id="exportDebugLog">üì• Export</button>
                        <button class="btn btn-secondary btn-sm" id="toggleDebugVerbose">üìä Verbose</button>
                    </div>
                </div>
                <div class="log-container" id="debugLog" style="max-height: 300px; overflow-y: auto;">
                    <p class="text-muted text-center">Debug log is empty. Pattern operations will be logged here.</p>
                </div>
            </div>
        </div>

        <!-- Tab 2: Event Mapper -->
        <div id="mapper" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Event Mappings</h2>
                    <div class="btn-group">
                        <button class="btn btn-success" id="addMapping">‚ûï Add Mapping</button>
                        <button class="btn btn-secondary" id="importMappings">üì• Import</button>
                        <button class="btn btn-secondary" id="exportMappings">üì§ Export</button>
                    </div>
                </div>
                <div id="mappingsList">
                    <p class="text-muted text-center">No mappings configured. Click "Add Mapping" to create one.</p>
                </div>
            </div>
        </div>

        <!-- Tab 3: Gift Catalog -->
        <div id="gifts" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üéÅ TikTok Gift Catalog</h2>
                    <div class="btn-group">
                        <button class="btn btn-primary" id="refreshGiftCatalog">üîÑ Refresh Catalog</button>
                    </div>
                </div>
                <div class="card-body">
                    <p class="text-muted">Below are all available TikTok gifts. You can create Event Mappings to trigger shock patterns when specific gifts are received.</p>
                    <div id="giftCatalogList">
                        <p class="text-center text-muted">Loading gift catalog...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 4: Safety -->
        <div id="safety" class="tab-content">
            <!-- Global Limits -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Global Safety Limits</h2>
                </div>
                <div class="grid-2">
                    <div class="form-group">
                        <div class="slider-label">
                            <span class="form-label">Max Intensity</span>
                            <span class="slider-value" id="globalMaxIntensityValue">100</span>
                        </div>
                        <input type="range" id="globalMaxIntensity" min="1" max="100" value="100">
                    </div>
                    <div class="form-group">
                        <div class="slider-label">
                            <span class="form-label">Max Duration (ms)</span>
                            <span class="slider-value" id="globalMaxDurationValue">30000</span>
                        </div>
                        <input type="range" id="globalMaxDuration" min="300" max="30000" step="100" value="30000">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Max Commands per Minute</label>
                        <input type="number" class="form-input" id="globalMaxCommandsPerMin" value="60" min="1" max="600">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Cooldown between Commands (ms)</label>
                        <input type="number" class="form-input" id="globalCooldown" value="1000" min="0" step="100">
                    </div>
                </div>
                <button class="btn btn-primary" id="saveGlobalLimits">üíæ Save Global Limits</button>
            </div>

            <!-- Device Limits -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Per-Device Limits</h2>
                </div>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Device</th>
                            <th>Max Intensity</th>
                            <th>Max Duration (ms)</th>
                            <th>Cooldown (ms)</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="deviceLimitsTable">
                        <tr>
                            <td colspan="5" class="text-center text-muted">No devices configured</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- User Limits -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">User Restrictions</h2>
                </div>
                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">Min Follower Age (days)</label>
                        <input type="number" class="form-input" id="minFollowerAge" value="0" min="0">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Max Commands per User (per session)</label>
                        <input type="number" class="form-input" id="maxCommandsPerUser" value="10" min="1">
                    </div>
                </div>
                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">Minimum Permission Level</label>
                        <select class="form-select" id="minPermissionLevel">
                            <option value="all">All Users</option>
                            <option value="subscriber">Subscribers Only</option>
                            <option value="vip">VIP & Above</option>
                            <option value="moderator">Moderators & Above</option>
                            <option value="broadcaster">Broadcaster Only</option>
                        </select>
                        <small class="form-hint">Restrict commands based on user role</small>
                    </div>
                    <div class="form-group">
                        <div class="form-checkbox" style="margin-top: 28px;">
                            <input type="checkbox" id="requireSuperfan">
                            <label class="form-label form-label-no-margin">Require Superfan Status</label>
                        </div>
                        <small class="form-hint">Only allow commands from superfans</small>
                    </div>
                </div>
                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">Whitelist (usernames, comma separated)</label>
                        <input type="text" class="form-input" id="whitelist" placeholder="user1, user2, user3">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Blacklist (usernames, comma separated)</label>
                        <input type="text" class="form-input" id="blacklist" placeholder="baduser1, baduser2">
                    </div>
                </div>
                <button class="btn btn-primary" id="saveUserLimits">üíæ Save User Limits</button>
            </div>

            <!-- Emergency Stop -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Emergency Controls</h2>
                </div>
                <div class="text-center">
                    <button class="btn btn-danger btn-lg" id="emergencyStop">üõë EMERGENCY STOP</button>
                    <p class="text-muted mt-2">Immediately stops all commands and pauses the queue</p>
                    <div id="emergencyStatus" class="mt-2"></div>
                </div>
            </div>
        </div>

        <!-- Tab 5: Patterns -->
        <div id="patterns" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">‚ö° Custom Patterns</h2>
                    <div class="btn-group">
                        <button class="btn btn-success" id="addPattern">‚ûï Neues Pattern</button>
                        <button class="btn btn-secondary" id="importPatterns">üì• Importieren</button>
                        <button class="btn btn-secondary" id="exportPatterns">üì§ Exportieren</button>
                    </div>
                </div>

                <!-- Info -->
                <div class="card-body">
                    <div class="alert alert-info">
                        <strong>üí° Info:</strong> Patterns sind Sequenzen von Schock-, Vibrations- und Pausen-Aktionen. 
                        Erstelle eigene Patterns mit individuellen Schritten und Kombinationen.
                    </div>
                </div>

                <!-- Custom Patterns List -->
                <div class="grid-3" id="customPatternsList">
                    <p class="text-muted text-center">Noch keine Patterns erstellt. Klicke auf "Neues Pattern" um eines zu erstellen.</p>
                </div>
            </div>
        </div>

        <!-- Tab 6: ZappieHell -->
        <div id="zappiehell" class="tab-content">
            <!-- ZappieHell Overview -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">‚ö° ZappieHell Goals & Event Chains</h2>
                </div>
                <div class="info-box">
                    <strong>üí° Info:</strong> ZappieHell is a goal-based system that triggers event chains when coin targets are reached.
                    Goals can be stream-specific (reset after each stream) or global (persistent across streams).
                    Event chains can include OpenShock actions, delays, TTS, webhooks, and overlay animations.
                </div>
            </div>

            <!-- Goals Management -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üéØ Goals</h2>
                    <button class="btn btn-success" id="addGoalBtn">‚ûï Add Goal</button>
                </div>
                <div id="goalsList">
                    <p class="text-muted">Loading goals...</p>
                </div>
            </div>

            <!-- Event Chains Management -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üîó Event Chains</h2>
                    <button class="btn btn-success" id="addChainBtn">‚ûï Add Event Chain</button>
                </div>
                <div id="chainsList">
                    <p class="text-muted">Loading event chains...</p>
                </div>
            </div>

            <!-- Overlay Links -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üì∫ ZappieHell Overlay</h2>
                </div>
                <div class="form-group">
                    <label class="form-label">OBS Browser Source URL</label>
                    <div class="input-group">
                        <input type="text" class="form-input" id="zappiehellOverlayUrl" readonly>
                        <button class="btn btn-secondary" id="copyZappieHellOverlayUrl">üìã Copy</button>
                    </div>
                </div>
                <div class="info-box">
                    <strong>üí° How to use:</strong> Copy the URL above and add it as a Browser Source in OBS.
                    The overlay will display active goals with progress bars and celebrate when goals are completed.
                </div>
            </div>
        </div>

        <!-- Tab 7: Advanced -->
        <div id="advanced" class="tab-content">
            <!-- API Settings -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">OpenShock API Settings</h2>
                </div>
                <div class="form-group">
                    <label class="form-label">API Key</label>
                    <input type="password" class="form-input" id="apiKey" placeholder="Enter your OpenShock API key">
                </div>
                <div class="form-group">
                    <label class="form-label">Base URL</label>
                    <input type="text" class="form-input" id="baseUrl" value="https://api.openshock.app" placeholder="https://api.openshock.app">
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" id="saveApiSettings">üíæ Save Settings</button>
                    <button class="btn btn-secondary" id="testConnection">üîå Test Connection</button>
                </div>
            </div>

            <!-- Queue Management -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Queue Management</h2>
                </div>
                <div class="btn-group">
                    <button class="btn btn-warning" id="pauseQueue">‚è∏Ô∏è Pause Queue</button>
                    <button class="btn btn-success" id="resumeQueue">‚ñ∂Ô∏è Resume Queue</button>
                    <button class="btn btn-danger" id="clearQueue">üóëÔ∏è Clear Queue</button>
                </div>
            </div>

            <!-- Debug Log -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Debug Log</h2>
                    <div class="btn-group">
                        <select class="form-select form-select-auto" id="logFilter">
                            <option value="all">All</option>
                            <option value="info">Info</option>
                            <option value="warning">Warning</option>
                            <option value="error">Error</option>
                        </select>
                        <button class="btn btn-secondary btn-sm" id="clearDebugLog">üóëÔ∏è Clear</button>
                        <button class="btn btn-secondary btn-sm" id="exportDebugLog">üì• Export</button>
                    </div>
                </div>
                <div class="log-container" id="debugLog">
                    <p class="text-muted text-center">Debug log is empty.</p>
                </div>
            </div>

            <!-- Detailed Statistics -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Detailed Statistics</h2>
                </div>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th>Value</th>
                        </tr>
                    </thead>
                    <tbody id="detailedStatsTable">
                        <tr>
                            <td>Total Events Received</td>
                            <td id="statTotalEvents">0</td>
                        </tr>
                        <tr>
                            <td>Total Commands Sent</td>
                            <td id="statTotalCommands">0</td>
                        </tr>
                        <tr>
                            <td>Successful Commands</td>
                            <td id="statSuccessfulCommands">0</td>
                        </tr>
                        <tr>
                            <td>Failed Commands</td>
                            <td id="statFailedCommands">0</td>
                        </tr>
                        <tr>
                            <td>Average Response Time</td>
                            <td id="statAvgResponseTime">0ms</td>
                        </tr>
                        <tr>
                            <td>Commands in Queue</td>
                            <td id="statQueueSize">0</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal: Mapping Editor -->
    <div id="mappingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="mappingModalTitle">Add Event Mapping</h2>
                <button class="modal-close" id="closeMappingModal">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Mapping Name</label>
                    <input type="text" class="form-input" id="mappingName" placeholder="e.g., Rose Gift Shock">
                </div>

                <div class="form-group">
                    <div class="form-checkbox">
                        <input type="checkbox" id="mappingEnabled" checked>
                        <label class="form-label form-label-no-margin">Enabled</label>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Event Type</label>
                    <select class="form-select" id="mappingEventType">
                        <option value="gift">Gift</option>
                        <option value="chat">Chat Message</option>
                        <option value="follow">Follow</option>
                        <option value="share">Share</option>
                        <option value="like">Like</option>
                        <option value="subscribe">Subscribe</option>
                    </select>
                </div>

                <!-- Conditions (dynamic based on event type) -->
                <div id="mappingConditions">
                    <div class="form-group" id="conditionGift">
                        <label class="form-label">Gift Name</label>
                        <select class="form-select" id="mappingGiftNameSelect">
                            <option value="">All Gifts</option>
                        </select>
                        <small class="form-help-text">Or enter custom name below:</small>
                        <input type="text" class="form-input" id="mappingGiftName" placeholder="e.g., Rose, TikTok (leave empty to use selection above)">
                    </div>
                    <div class="grid-2" id="conditionCoinRange">
                        <div class="form-group">
                            <label class="form-label">Min Coins</label>
                            <input type="number" class="form-input" id="mappingMinCoins" value="0" min="0" placeholder="0 = keine Untergrenze">
                            <small class="form-hint">Minimum Coins (0 = keine Grenze)</small>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Max Coins</label>
                            <input type="number" class="form-input" id="mappingMaxCoins" value="" min="0" placeholder="leer = keine Obergrenze">
                            <small class="form-hint">Maximum Coins (leer = keine Grenze)</small>
                        </div>
                    </div>
                    <div class="form-group hidden" id="conditionMessagePattern">
                        <label class="form-label">Message Pattern (regex)</label>
                        <input type="text" class="form-input" id="mappingMessagePattern" placeholder="e.g., ^!shock">
                    </div>
                </div>

                <!-- Action Configuration -->
                <div class="form-group">
                    <label class="form-label">Action Type</label>
                    <select class="form-select" id="mappingActionType">
                        <option value="shock">Shock</option>
                        <option value="vibrate">Vibrate</option>
                        <option value="sound">Sound</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Device</label>
                    <select class="form-select" id="mappingDevice">
                        <option value="">Select Device...</option>
                    </select>
                </div>

                <div class="form-group">
                    <div class="slider-label">
                        <span class="form-label">Intensity</span>
                        <span class="slider-value" id="mappingIntensityValue">50</span>
                    </div>
                    <input type="range" id="mappingIntensity" min="1" max="100" value="50">
                </div>

                <div class="form-group">
                    <div class="slider-label">
                        <span class="form-label">Duration (ms)</span>
                        <span class="slider-value" id="mappingDurationValue">1000</span>
                    </div>
                    <input type="range" id="mappingDuration" min="300" max="30000" step="100" value="1000">
                </div>

                <div class="form-group">
                    <label class="form-label">Pattern (optional)</label>
                    <select class="form-select" id="mappingPattern">
                        <option value="">None (Single pulse)</option>
                    </select>
                </div>

                <!-- Cooldowns -->
                <div class="grid-3">
                    <div class="form-group">
                        <label class="form-label">Global Cooldown (ms)</label>
                        <input type="number" class="form-input" id="mappingGlobalCooldown" value="0" min="0" step="100">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Per-Device Cooldown (ms)</label>
                        <input type="number" class="form-input" id="mappingDeviceCooldown" value="0" min="0" step="100">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Per-User Cooldown (ms)</label>
                        <input type="number" class="form-input" id="mappingUserCooldown" value="0" min="0" step="100">
                    </div>
                </div>

                <!-- Safety Overrides -->
                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">Max Intensity Override</label>
                        <input type="number" class="form-input" id="mappingMaxIntensity" value="100" min="1" max="100">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Max Duration Override (ms)</label>
                        <input type="number" class="form-input" id="mappingMaxDuration" value="30000" min="300" step="100">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="saveMappingBtn">üíæ Save Mapping</button>
                <button class="btn btn-secondary" id="cancelMappingBtn">‚ùå Cancel</button>
            </div>
        </div>
    </div>

    <!-- Modal: Pattern Editor (Simplified) -->
    <div id="patternModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="patternModalTitle">‚ö° Neues Pattern erstellen</h2>
                <button class="modal-close" id="closePatternModal">√ó</button>
            </div>
            <div class="modal-body">
                <!-- Pattern Info -->
                <div class="alert alert-info mb-3">
                    <strong>üí° So funktioniert's:</strong> F√ºge einzelne Schritte hinzu (Shock, Vibration, Sound, Pause). 
                    Die Schritte werden nacheinander ausgef√ºhrt.
                </div>

                <div class="form-group">
                    <label class="form-label"><strong>Pattern-Name</strong></label>
                    <input type="text" class="form-input" id="patternName" placeholder="z.B. Sanftes Aufwachen, Intensiver Blitz, ...">
                </div>

                <div class="form-group">
                    <label class="form-label">Beschreibung (optional)</label>
                    <input type="text" class="form-input" id="patternDescription" placeholder="Kurze Beschreibung des Patterns">
                </div>

                <!-- Step Builder - Simplified -->
                <div class="card mt-3" id="quickStepForm">
                    <div class="card-header">
                        <h3 class="modal-title-small">‚ûï Schritt hinzuf√ºgen</h3>
                    </div>
                    <div class="modal-body-padding">
                        <div class="grid-2 mb-3">
                            <div class="form-group">
                                <label class="form-label">Aktion</label>
                                <select class="form-select" id="stepType">
                                    <option value="shock">‚ö° Schock</option>
                                    <option value="vibrate">üì≥ Vibration</option>
                                    <option value="pause">‚è∏Ô∏è Pause</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Dauer (Millisekunden)</label>
                                <input type="number" class="form-input" id="stepDuration" value="500" min="300" max="30000" step="100">
                                <small class="form-hint">Min: 300ms, Max: 30000ms</small>
                            </div>
                        </div>
                        <div class="form-group" id="stepIntensityGroup">
                            <label class="form-label">Intensit√§t: <span id="stepIntensityValue">50</span>%</label>
                            <input type="range" id="stepIntensity" min="1" max="100" value="50" class="slider-large">
                        </div>
                        <button class="btn btn-success btn-block" id="addPatternStep">
                            ‚ûï Schritt zum Pattern hinzuf√ºgen
                        </button>
                    </div>
                </div>

                <!-- Step List -->
                <div class="form-group mt-3">
                    <div class="step-list-header">
                        <label class="form-label"><strong>Pattern-Schritte</strong> (<span id="stepCountLabel">0</span> Schritte)</label>
                        <button class="btn btn-sm btn-danger" id="clearAllSteps" style="display: none;">üóëÔ∏è Alle l√∂schen</button>
                    </div>
                    <div class="step-list" id="patternSteps">
                        <div class="text-muted text-center p-3">Noch keine Schritte hinzugef√ºgt. F√ºge oben deinen ersten Schritt hinzu.</div>
                    </div>
                </div>

                <!-- Visual Preview -->
                <div class="form-group mt-3">
                    <label class="form-label">Vorschau</label>
                    <div class="pattern-timeline" id="patternPreview">
                        <p class="text-muted text-center pattern-timeline-text">Schritte hinzuf√ºgen f√ºr Vorschau</p>
                    </div>
                    <div class="pattern-info" id="patternInfo" style="display: none;">
                        <small class="text-muted">
                            <strong>Gesamtdauer:</strong> <span id="totalDuration">0</span>ms
                        </small>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary btn-lg" id="savePatternBtn">üíæ Pattern speichern</button>
                <button class="btn btn-secondary" id="cancelPatternBtn">‚ùå Abbrechen</button>
            </div>
        </div>
    </div>

    <!-- Modal: Goal Editor -->
    <div id="goalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="goalModalTitle">‚ö° Add ZappieHell Goal</h2>
                <button class="modal-close" id="closeGoalModal">√ó</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="goalId">
                
                <div class="form-group">
                    <label class="form-label">Goal Name *</label>
                    <input type="text" class="form-input" id="goalName" placeholder="e.g., ZappieHell Level 1" required>
                </div>

                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">Target Coins *</label>
                        <input type="number" class="form-input" id="goalTargetCoins" placeholder="5000" min="1" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Current Coins</label>
                        <input type="number" class="form-input" id="goalCurrentCoins" placeholder="0" min="0" value="0">
                    </div>
                </div>

                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">Goal Type</label>
                        <select class="form-select" id="goalType">
                            <option value="stream">üî¥ Stream (resets after stream ends)</option>
                            <option value="global">üåê Global (persistent across streams)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Event Chain</label>
                        <select class="form-select" id="goalChainId">
                            <option value="">-- No chain --</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-checkbox">
                        <input type="checkbox" id="goalActive" checked>
                        <span>Active</span>
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary btn-lg" id="saveGoalBtn">üíæ Save Goal</button>
                <button class="btn btn-secondary" id="cancelGoalBtn">‚ùå Cancel</button>
            </div>
        </div>
    </div>

    <!-- Modal: Event Chain Editor -->
    <div id="chainModal" class="modal">
        <div class="modal-content-large">
            <div class="modal-header">
                <h2 class="modal-title" id="chainModalTitle">üîó Add Event Chain</h2>
                <button class="modal-close" id="closeChainModal">√ó</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="chainId">
                
                <div class="form-group">
                    <label class="form-label">Chain Name *</label>
                    <input type="text" class="form-input" id="chainName" placeholder="e.g., ZappieHell Level 1 Chain" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-input" id="chainDescription" rows="2" placeholder="Describe what this chain does..."></textarea>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="modal-title-small">Chain Steps</h3>
                        <button class="btn btn-success btn-sm" id="addChainStepBtn">‚ûï Add Step</button>
                    </div>
                    <div id="chainStepsList">
                        <p class="text-muted" style="padding: 20px;">No steps added yet. Click "Add Step" to begin.</p>
                    </div>
                </div>

                <div class="info-box mt-3">
                    <strong>üí° Available Step Types:</strong>
                    <ul style="margin-top: 8px; margin-left: 20px;">
                        <li><strong>OpenShock:</strong> Trigger OpenShock pattern or direct command</li>
                        <li><strong>Delay:</strong> Wait for specified duration before next step</li>
                        <li><strong>Audio/TTS:</strong> Play audio or text-to-speech</li>
                        <li><strong>Webhook:</strong> Send HTTP request to external URL</li>
                        <li><strong>Overlay:</strong> Trigger overlay animation</li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary btn-lg" id="saveChainBtn">üíæ Save Event Chain</button>
                <button class="btn btn-secondary" id="cancelChainBtn">‚ùå Cancel</button>
            </div>
        </div>
    </div>

    <!-- Modal: Chain Step Editor -->
    <div id="stepModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="stepModalTitle">‚ûï Add Chain Step</h2>
                <button class="modal-close" id="closeStepModal">√ó</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="stepIndex">
                
                <div class="form-group">
                    <label class="form-label">Step Type *</label>
                    <select class="form-select" id="stepTypeSelect">
                        <option value="openshock">‚ö° OpenShock</option>
                        <option value="delay">‚è±Ô∏è Delay</option>
                        <option value="audio">üîä Audio/TTS</option>
                        <option value="webhook">üåê Webhook</option>
                        <option value="overlay">üì∫ Overlay Animation</option>
                    </select>
                </div>

                <!-- OpenShock Step Fields -->
                <div id="openshockStepFields" class="step-fields">
                    <div class="form-group">
                        <label class="form-label">Pattern</label>
                        <select class="form-select" id="stepPatternId">
                            <option value="">-- Direct Command --</option>
                        </select>
                    </div>

                    <div class="grid-2" id="directCommandFields">
                        <div class="form-group">
                            <label class="form-label">Command Type</label>
                            <select class="form-select" id="stepCommandType">
                                <option value="vibrate">üì≥ Vibrate</option>
                                <option value="shock">‚ö° Shock</option>
                                <option value="sound">üîä Sound</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Device</label>
                            <select class="form-select" id="stepDeviceId">
                                <option value="">-- First Available --</option>
                            </select>
                        </div>
                    </div>

                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">Intensity (1-100)</label>
                            <input type="number" class="form-input" id="stepIntensity" value="50" min="1" max="100">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Duration (ms)</label>
                            <input type="number" class="form-input" id="stepDurationMs" value="1000" min="300" max="30000">
                        </div>
                    </div>
                </div>

                <!-- Delay Step Fields -->
                <div id="delayStepFields" class="step-fields" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Delay Duration (ms)</label>
                        <input type="number" class="form-input" id="delayDurationMs" value="2000" min="100" max="60000">
                    </div>
                </div>

                <!-- Audio Step Fields -->
                <div id="audioStepFields" class="step-fields" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Audio ID or TTS Text</label>
                        <input type="text" class="form-input" id="audioText" placeholder="Enter text for TTS or audio ID">
                    </div>
                </div>

                <!-- Webhook Step Fields -->
                <div id="webhookStepFields" class="step-fields" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">URL *</label>
                        <input type="url" class="form-input" id="webhookUrl" placeholder="https://example.com/webhook">
                    </div>

                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">Method</label>
                            <select class="form-select" id="webhookMethod">
                                <option value="POST">POST</option>
                                <option value="GET">GET</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Request Body (JSON)</label>
                        <textarea class="form-input" id="webhookBody" rows="4" placeholder='{"key": "value"}'>{}</textarea>
                    </div>
                </div>

                <!-- Overlay Step Fields -->
                <div id="overlayStepFields" class="step-fields" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Animation Type</label>
                        <input type="text" class="form-input" id="overlayAnimationType" placeholder="e.g., flash, pulse">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Duration (ms)</label>
                        <input type="number" class="form-input" id="overlayDuration" value="1000" min="100" max="10000">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary btn-lg" id="saveStepBtn">üíæ Save Step</button>
                <button class="btn btn-secondary" id="cancelStepBtn">‚ùå Cancel</button>
            </div>
        </div>
    </div>

    <!-- Socket.IO Client Library -->
    <script src="/socket.io/socket.io.js"></script>

    <!-- OpenShock UI JavaScript -->
    <script src="/openshock/ui.js"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XP Bar Overlay</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: transparent;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow: hidden;
    }

    .xp-container {
      padding: 20px;
      display: none;
    }

    .xp-container.visible {
      display: block;
    }

    .viewer-info {
      background: rgba(0, 0, 0, 0.8);
      border-radius: 10px;
      padding: 15px 20px;
      display: flex;
      align-items: center;
      gap: 15px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
      border: 2px solid rgba(255, 255, 255, 0.2);
      min-width: 400px;
    }

    .profile-pic {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: 3px solid #FFD700;
      object-fit: cover;
    }

    .info-content {
      flex: 1;
    }

    .username {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 5px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
    }

    .title {
      font-size: 14px;
      color: #FFD700;
      margin-bottom: 8px;
      font-style: italic;
    }

    .xp-bar-container {
      background: rgba(0, 0, 0, 0.5);
      border-radius: 20px;
      height: 30px;
      position: relative;
      overflow: hidden;
      border: 2px solid rgba(255, 255, 255, 0.3);
    }

    .xp-bar {
      background: linear-gradient(90deg, #4CAF50, #8BC34A);
      height: 100%;
      border-radius: 18px;
      transition: width 0.5s ease-out;
      position: relative;
      overflow: hidden;
    }

    .xp-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.3),
        transparent
      );
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .xp-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 14px;
      font-weight: bold;
      color: white;
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
      z-index: 1;
      white-space: nowrap;
    }

    .level-badge {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 18px;
      font-weight: bold;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      border: 2px solid rgba(255, 255, 255, 0.3);
    }

    .xp-gain {
      position: fixed;
      font-size: 24px;
      font-weight: bold;
      color: #4CAF50;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
      pointer-events: none;
      animation: floatUp 2s ease-out forwards;
      z-index: 1000;
    }

    @keyframes floatUp {
      0% {
        opacity: 1;
        transform: translateY(0);
      }
      100% {
        opacity: 0;
        transform: translateY(-100px);
      }
    }

    .level-up-animation {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 48px;
      font-weight: bold;
      color: #FFD700;
      text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.8);
      animation: levelUpPulse 2s ease-out forwards;
      z-index: 1001;
      pointer-events: none;
    }

    @keyframes levelUpPulse {
      0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.5);
      }
      50% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1.2);
      }
      100% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(1);
      }
    }
  </style>
</head>
<body>
  <div class="xp-container" id="xpContainer">
    <div class="viewer-info">
      <img src="" alt="Profile" class="profile-pic" id="profilePic" style="display: none;">
      <div class="info-content">
        <div class="username" id="username"></div>
        <div class="title" id="title"></div>
        <div class="xp-bar-container">
          <div class="xp-bar" id="xpBar"></div>
          <div class="xp-text" id="xpText"></div>
        </div>
      </div>
      <div class="level-badge" id="levelBadge"></div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    let currentViewer = null;
    let displayTimeout = null;

    // Get URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const autoHide = urlParams.get('autoHide') !== 'false';
    const displayDuration = parseInt(urlParams.get('duration') || '5000');
    const showProfilePic = urlParams.get('showPic') !== 'false';

    // Update display
    function updateDisplay(profile) {
      if (!profile) return;

      currentViewer = profile;

      // Update elements
      document.getElementById('username').textContent = profile.username;
      document.getElementById('username').style.color = profile.name_color || '#FFFFFF';
      document.getElementById('title').textContent = profile.title || '';
      document.getElementById('levelBadge').textContent = `Level ${profile.level}`;

      // Update XP bar
      const percentage = Math.min(100, Math.max(0, profile.xp_progress_percent || 0));
      document.getElementById('xpBar').style.width = percentage + '%';
      document.getElementById('xpText').textContent = 
        `${profile.xp_progress || 0} / ${profile.xp_for_next_level || 100} XP`;

      // Update profile picture
      if (showProfilePic && profile.profilePictureUrl) {
        const pic = document.getElementById('profilePic');
        pic.src = profile.profilePictureUrl;
        pic.style.display = 'block';
      }

      // Show container
      const container = document.getElementById('xpContainer');
      container.classList.add('visible');

      // Auto-hide
      if (autoHide) {
        if (displayTimeout) clearTimeout(displayTimeout);
        displayTimeout = setTimeout(() => {
          container.classList.remove('visible');
        }, displayDuration);
      }
    }

    // Show XP gain animation
    function showXPGain(amount, username) {
      const container = document.getElementById('xpContainer');
      const rect = container.getBoundingClientRect();
      
      const element = document.createElement('div');
      element.className = 'xp-gain';
      element.textContent = `+${amount} XP`;
      element.style.left = (rect.left + rect.width / 2) + 'px';
      element.style.top = (rect.top + rect.height / 2) + 'px';
      
      document.body.appendChild(element);
      
      setTimeout(() => {
        element.remove();
      }, 2000);
    }

    // Show level up animation
    function showLevelUp(data) {
      const element = document.createElement('div');
      element.className = 'level-up-animation';
      element.textContent = `ðŸŽ‰ Level ${data.newLevel}! ðŸŽ‰`;
      
      document.body.appendChild(element);
      
      setTimeout(() => {
        element.remove();
      }, 2000);
    }

    // Listen for XP updates
    socket.on('viewer-xp:update', (data) => {
      if (data.profile) {
        updateDisplay(data.profile);
        showXPGain(data.amount, data.username);
      }
    });

    // Listen for level ups
    socket.on('viewer-xp:level-up', (data) => {
      showLevelUp(data);
      // Request updated profile
      socket.emit('viewer-xp:get-profile', data.username);
    });

    // Listen for profile updates
    socket.on('viewer-xp:profile', (profile) => {
      if (profile) {
        updateDisplay(profile);
      }
    });

    // Request initial profile if username provided
    const initialUsername = urlParams.get('username');
    if (initialUsername) {
      socket.emit('viewer-xp:get-profile', initialUsername);
    }
  </script>
</body>
</html>

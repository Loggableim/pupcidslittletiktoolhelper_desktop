# EulerStream Authentication Guide

This guide explains the different authentication methods and keys used with EulerStream Sign Server API.

## Understanding Different Key Types

EulerStream Sign Server provides different keys for different purposes. **For WebSocket connections, you need the WEBHOOK SECRET, not the euler_ API key!**

### 1. Webhook Secret OR API Key (für WebSocket Verbindungen) ✅ **DU BRAUCHST EINEN VON DIESEN**

**Zweck:** Authentifizierung für WebSocket-Verbindungen um Live-TikTok-Stream-Daten zu empfangen

**WICHTIG - Du hast zwei verschiedene Keys, aber nur der API Key (mit `euler_` Präfix) funktioniert für Community Plan:**

**Option 1: API Key (euler_ Präfix) - EMPFOHLEN für Community Plan**
- **Format:** `euler_` gefolgt von Base64-kodierten Zeichen
- **Beispiel:** `euler_NTI1MTFmMmJkZmE2MTFmODA4Njk5NWVjZDA1NDk1OTUxZDMyNzE0NDIyYzJmZDVlZDRjOWU2`
- **Wo zu finden:** EulerStream Dashboard → API Keys Bereich
- **Plan:** Funktioniert mit Community Plan ✅

**Option 2: Webhook Secret (Hexadezimal) - NUR für spezielle Zwecke**
- **Format:** 64-Zeichen Hexadezimal-String
- **Beispiel:** `69247cb1f28bac46e315f650c64507e828acb4f61718b2bf5526c5fbbdebb7a8`
- **Wo zu finden:** EulerStream Dashboard → Account Details → "Webhook Secret"
- **Verwendung:** Primär für HTTP Webhook-Validierung, nicht für WebSocket-Verbindungen

**FEHLER BEHOBEN:** Die vorherige Version verwendete `useEnterpriseApi: true`, was ein Enterprise Plan Upgrade erfordert. Das wurde jetzt entfernt.

**Wie zu verwenden:**
- **Umgebungsvariable:** `EULER_API_KEY=euler_dein_api_key_hier` in `.env` Datei
- **Dashboard-Einstellung:** Setze `tiktok_euler_api_key` auf deinen API Key
- **Legacy Variable:** `SIGN_API_KEY=euler_dein_api_key_hier` (für Rückwärtskompatibilität)

**Beispiel:**
```bash
# In .env Datei - Verwende den API Key mit euler_ Präfix
EULER_API_KEY=euler_NTI1MTFmMmJkZmE2MTFmODA4Njk5NWVjZDA1NDk1OTUxZDMyNzE0NDIyYzJmZDVlZDRjOWU2
```

**Was es macht:**
- Authentifiziert deine WebSocket-Verbindung zu `wss://ws.eulerstream.com`
- Erlaubt dir Echtzeit-Stream-Events zu empfangen (Chat, Geschenke, Likes, etc.)
- Nur im Backend verwenden (niemals im Frontend-Code exponieren)

**Beispiel:**
```javascript
const wsUrl = createWebSocketUrl({
    uniqueId: 'tiktok_username',
    apiKey: 'euler_NTI1MTFmMmJkZmE2MTFmODA4Njk5NWVjZDA1NDk1OTUxZDMyNzE0NDIyYzJmZDVlZDRjOWU2' // API Key mit euler_ Präfix
});
```

**WICHTIG - Enterprise API Feature:**
- Die vorherige Version verwendete `features: { useEnterpriseApi: true }`
- Dies erfordert ein Enterprise Plan Upgrade
- Für Community Plan: NICHT `useEnterpriseApi` verwenden
- Die Fehlermeldung war: "You cannot access the Enterprise servers without the Enterprise servers feature"

### 2. REST API Key (NOT for WebSockets) ❌ **DO NOT USE THIS**

**Purpose:** Authenticate REST API calls to EulerStream Sign Server (NOT WebSockets!)

**Where to get it:**
- Found in your EulerStream Dashboard → API Keys section
- Format: `euler_` prefix followed by base64-encoded data
- Example: `euler_NTI1MTFmMmJkZmE2MTFmODA4Njk5NWVjZDA1NDk1OTUxZDMyNzE0NDIyYzJmZDVlZDRjOWU2`

**When to use:**
- ❌ **NOT for WebSocket connections**
- ✅ Only for REST API endpoints (if you're making direct API calls)
- ✅ For creating JWTs via the REST API

**CRITICAL:** Do NOT use this key for WebSocket connections! It will NOT work!

### 2. JWT Key (for Frontend WebSocket Connections)

**Purpose:** Temporary authentication token for frontend/client-side WebSocket connections

**Where to get it:**
- Generated by YOUR backend server using the EulerStream API
- Uses your API Key to generate time-limited JWTs
- Each JWT can have restricted permissions (specific users, connection limits, expiration)

**How to use it:**
```javascript
// Backend: Generate JWT
const jwt = await eulerstream.createJWT({
    allowedCreators: ['specific_username'],
    maxWebSockets: 1,
    expireAfter: 3600 // 1 hour
});

// Frontend: Use JWT for connection
const wsUrl = createWebSocketUrl({
    uniqueId: 'tiktok_username',
    jwtKey: jwt
});
```

**When to use:**
- ❌ **NOT needed for this application** (it's a backend service)
- ✅ Used when you have a web frontend that connects directly to EulerStream
- ✅ Prevents exposing your API key in client-side code

### 3. Webhook Secret (for HTTP Webhook Validation) ❌ **NOT FOR WEBSOCKETS**

**Purpose:** Validate HTTP webhook requests from EulerStream Live Alerts

**Where to get it:**
- Found in your EulerStream Dashboard → Account Details → "Webhook Secret"
- Format: 64-character hexadecimal string (e.g., `69247cb1f28bac46e315f650c64507e828acb4f61718b2bf5526c5fbbdebb7a8`)
- Used to verify HMAC signatures on incoming HTTP webhooks

**CRITICAL:** This is **NOT** the same as your API Key! Do not use this for WebSocket connections!

**How to use it:**
```javascript
// Validate incoming webhook
const crypto = require('crypto');
function validateWebhook(secret, payload, receivedSignature) {
    const expectedSignature = crypto
        .createHmac('sha256', secret)
        .update(payload)
        .digest('hex');
    return crypto.timingSafeEqual(
        Buffer.from(receivedSignature, 'hex'),
        Buffer.from(expectedSignature, 'hex')
    );
}
```

**When to use:**
- ❌ **NOT for WebSocket connections**
- ✅ Only when receiving HTTP POST requests from EulerStream Live Alerts
- ✅ For validating that webhook payloads are authentic

## Common Misconceptions

### "I need the webhook secret key for WebSocket connections"
❌ **INCORRECT** - Webhook secrets are ONLY for HTTP webhook validation, NOT WebSocket authentication.

For WebSocket connections, you need:
- **Backend:** API Key (what this application uses) ✅
- **Frontend:** JWT Key (not needed for this application)

### "Account API Key doesn't work for stream data"
❌ **INCORRECT** - The API Key from your EulerStream account dashboard IS the correct key for WebSocket connections.

If you're connected but not receiving data, possible causes:
1. The streamer is not actually live
2. The username is incorrect
3. Network/firewall issues
4. API key has insufficient permissions (contact EulerStream support)

### "I'm using the wrong API"
❌ **INCORRECT** - This application correctly uses the EulerStream WebSocket API with API Key authentication.

The EulerStream WebSocket API (`wss://ws.eulerstream.com`) is the correct endpoint for receiving live stream data.

## Current Implementation

This application uses the **API Key authentication method** for backend WebSocket connections, which is the correct and recommended approach for server-side applications.

```javascript
// From modules/tiktok.js
const wsUrl = createWebSocketUrl({
    uniqueId: username,
    apiKey: apiKey,  // ← Your API key from EulerStream dashboard
    features: {
        useEnterpriseApi: true  // Recommended for better reliability
    }
});
```

## Troubleshooting

### Connection succeeds but no data is received

**Possible causes:**

1. **User is not live**
   - Verify the TikTok user is actually streaming
   - Check on TikTok website/app directly

2. **Incorrect username**
   - Use the username without @ symbol
   - Verify spelling is correct

3. **API Key permissions**
   - Some API keys may have restrictions
   - Contact EulerStream support if you suspect permission issues

4. **Network issues**
   - Check firewall settings
   - Verify WebSocket connections are not blocked
   - Check proxy settings if applicable

### Authentication errors (4401 - INVALID_AUTH)

**Causes:**
- API Key is invalid, expired, or malformed
- Extra spaces/quotes in the key
- Using the wrong type of key

**Solutions:**
1. Log in to https://www.eulerstream.com
2. Verify your API key in the dashboard
3. Generate a new API key if needed
4. Update your configuration
5. Ensure no extra spaces or quotes

## Quick Reference

| Service                | Authentication Method | Key Location                    | Used For                          |
|------------------------|----------------------|--------------------------------|-----------------------------------|
| **WebSocket (Backend)** | API Key              | Dashboard → API Keys            | **This application ✅**           |
| **WebSocket (Frontend)** | JWT Key              | Generated by your backend       | Client-side apps only             |
| **HTTP Webhooks**      | Webhook Secret       | Dashboard → Live Alerts         | HTTP webhook validation only      |

## Getting Help

If you're still experiencing issues:

1. **Verify API Key:** Log in to https://www.eulerstream.com and check your API key
2. **Test Connection:** Run `node test-euler-connection.js username` (replace username with a live streamer)
3. **Check Logs:** Look for detailed error messages in the application logs
4. **EulerStream Support:** Contact EulerStream support for API-specific issues
5. **Application Issues:** Open a GitHub issue with your logs (API key redacted)

## Further Reading

- [EulerStream WebSocket Documentation](https://www.eulerstream.com/docs/sign-server/websockets)
- [EulerStream OpenAPI Specification](https://www.eulerstream.com/docs/openapi)
- [EulerStream Live Alerts (HTTP Webhooks)](https://www.eulerstream.com/docs/sign-server/live-alerts)
- [EULERSTREAM_API_GUIDE.md](../EULERSTREAM_API_GUIDE.md) - Configuration and troubleshooting
